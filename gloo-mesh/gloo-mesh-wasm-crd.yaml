# Code generated by skv2. DO NOT EDIT.

apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    app: gloo-mesh-enterprise-extender
    app.kubernetes.io/name: gloo-mesh-enterprise-extender
  name: wasmdeployments.enterprise.networking.mesh.gloo.solo.io
spec:
  group: enterprise.networking.mesh.gloo.solo.io
  names:
    kind: WasmDeployment
    listKind: WasmDeploymentList
    plural: wasmdeployments
    singular: wasmdeployment
  preserveUnknownFields: false
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      properties:
        spec:
          description: A WasmDeployment deploys one or more WASM Envoy Filters to selected Sidecars and Gateways in a Mesh.
          properties:
            filters:
              description: Parameters for specifying the WASM filter
              items:
                allOf:
                - oneOf:
                  - not:
                      anyOf:
                      - required:
                        - localPathSource
                      - {}
                      - required:
                        - httpUriSource
                      - {}
                      - required:
                        - wasmImageSource
                  - required:
                    - localPathSource
                  - not:
                      anyOf:
                      - {}
                      - required:
                        - localPathSource
                      - required:
                        - httpUriSource
                      - {}
                      - required:
                        - wasmImageSource
                  - required:
                    - httpUriSource
                  - not:
                      anyOf:
                      - {}
                      - required:
                        - localPathSource
                      - {}
                      - required:
                        - httpUriSource
                      - required:
                        - wasmImageSource
                  - required:
                    - wasmImageSource
                - oneOf:
                  - not:
                      anyOf:
                      - required:
                        - staticFilterConfig
                      - required:
                        - dynamicFilterConfig
                  - required:
                    - staticFilterConfig
                  - required:
                    - dynamicFilterConfig
                properties:
                  dynamicFilterConfig:
                    description: |-
                      Provide configuration from a dynamic configuration source.
                      This is used to connect proxies to a user-provided configuration server
                      rather than using the WasmDeployment CR to update filter configuration.
                      NOTE: Not currently implemented. This field serves as a placeholder.
                      passing it to the plugin. `google.protobuf.BytesValue` and
                      `google.protobuf.StringValue` are passed directly without the wrapper.
                      TODO(ilackarms): implement with dynamic filter config source (FCDS) https://github.com/envoyproxy/envoy/issues/7867
                    type: string
                  filterContext:
                    description: |-
                      The specific config generation context to which to attach the filter. Istio
                      generates envoy configuration in the context of a gateway,
                      inbound traffic to sidecar and outbound traffic from sidecar.
                      Uses the Istio default (ANY).
                    enum:
                    - ANY
                    - SIDECAR_INBOUND
                    - SIDECAR_OUTBOUND
                    - GATEWAY
                    type: string
                  httpUriSource:
                    description: |-
                      Select `http_uri_source` to deploy the filter from an HTTP/S URI accessible
                      to the workload proxy. Note that Gloo Mesh cannot verify
                      whether the target workload proxy containers have HTTP accesss the given URI.
                      If filters do not load, please inspect the sidecar proxy logs.
                    properties:
                      sha:
                        description: |-
                          The Sha256 Checksum of the filter binary (will be verified by the proxy).
                          Required.
                        type: string
                      uri:
                        description: The HTTP URI from which to fetch the filter
                        type: string
                    type: object
                  localPathSource:
                    description: |-
                      Select `local_path_source` to deploy the filter from a file accessible
                      to the workload proxy. Note that Gloo Mesh cannot verify
                      whether the target workload proxy containers contain the given path.
                      If filters do not load, please inspect the sidecar proxy logs.
                    type: string
                  rootId:
                    description: |-
                      the root id must match the root id
                      defined inside the filter.
                      if the user does not provide this field,
                      Gloo Mesh will attempt to pull the image
                      and set it from the filter_conf contained in the image config.
                      note that if the filter_source is not set to wasm_image_source,
                      this field is required
                    type: string
                  staticFilterConfig:
                    description: |-
                      Provide configuration as a static
                      `google.protobuf.Struct` is serialized as JSON before
                      passing it to the plugin. `google.protobuf.BytesValue` and
                      `google.protobuf.StringValue` are passed directly without the wrapper.
                    properties:
                      '@type':
                        description: |-
                          A URL/resource name that uniquely identifies the type of the serialized protocol buffer message. This string must contain at least one "/" character. The last segment of the URL's path must represent the fully qualified name of the type (as in `type.googleapis.com/google.protobuf.Duration`). The name should be in a canonical form (e.g., leading "." is not accepted).
                          The remaining fields of this object correspond to fields of the proto messsage. If the embedded message is well-known and has a custom JSON representation, that representation is assigned to the 'value' field.
                        type: string
                    required:
                    - '@type'
                    type: object
                  vmId:
                    description: |-
                      An ID which will be used along with a hash of the wasm code
                      (or the name of the registered Null VM plugin) to determine which VM will be used to load the WASM filter.
                      All filters on the same proxy which use the same vm_id and code within will use the same VM.
                      May be left blank. Sharing a VM between plugins can reduce memory utilization and make sharing of data easier which may have security implications.
                    type: string
                  wasmImageSource:
                    description: |-
                      fetch the image from a [WASM OCI Registry](https://webassemblyhub.io/)
                      Images can be built and pushed to registries using `meshctl` and `wasme`.
                    properties:
                      wasmImageTag:
                        description: the full tag of the wasm image. should include the registry address at the beginning, e.g. webassemblyhub.io/ilackarms/helloworld:v0.1
                        type: string
                    type: object
                type: object
              type: array
            weight:
              description: |-
                weight is used to determine the order of WASM Filters when applying
                multiple WasmDeployments to a single workload.
                Deployed WASM filters will be sorted in order of
                highest to lowest weight.
                Note that all WASM Filters are currently inserted just before the Envoy router filter
                in the HTTP Connection Manager's HTTP Filter Chain.
              maximum: 4294967295
              minimum: 0
              type: integer
            workloadSelector:
              description: |-
                Sidecars/Gateways whose Workloads match these selectors will attach the specified WASM Filters.
                       Leave empty to have all workloads in the mesh apply receive the WASM Filter.
              items:
                properties:
                  clusters:
                    description: |-
                      If specified, match k8s workloads if they exist in one of the specified clusters.
                             When used in a networking policy, omission matches any cluster.
                             When used in a Role, a wildcard `"*"` must be explicitly used to match any cluster.
                    items:
                      type: string
                    type: array
                  labels:
                    additionalProperties:
                      type: string
                    description: |-
                      If specified, all labels must exist on k8s workload.
                             When used in a networking policy, omission matches any labels.
                             When used in a Role, a wildcard `"*"` must be explicitly used to match any label key and/or value.
                    type: object
                  namespaces:
                    description: |-
                      If specified, match k8s workloads if they exist in one of the specified namespaces.
                             When used in a networking policy, omission matches any namespace.
                             When used in a Role, a wildcard `"*"` must be explicitly used to match any namespace.
                    items:
                      type: string
                    type: array
                type: object
              type: array
          type: object
        status:
          properties:
            error:
              description: Any errors found while processing this generation of the resource.
              type: string
            observedGeneration:
              description: |-
                The most recent generation observed in the the WasmDeployment metadata.
                if the observedGeneration does not match generation, the controller has not received the most
                recent version of this resource.
              format: int64
              type: integer
            state:
              description: |-
                The state of the overall resource.
                It will only show accepted if it has been successfully
                applied to all target meshes.
              enum:
              - PENDING
              - VALIDATED
              - APPLIED
              - INVALID
              - FAILED
              type: string
            workloads:
              description: The set of Workloads to which the Wasm Filters have been deployed.
              items:
                properties:
                  name:
                    description: name of the resource being referenced
                    type: string
                  namespace:
                    description: namespace of the resource being referenced
                    type: string
                type: object
              type: array
          type: object
      type: object
  versions:
  - name: v1alpha1
    served: true
    storage: true